<form method="POST">
    <div class="row">
        <div class="col-12">
            <!-- Modern Card with Tabs -->
            <div class="card card-body bg-white shadow-lg border-0 px-0 py-0">

                <!-- Step Indicator -->
                <div class="bg-gradient-info px-4 py-3 rounded-top">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="text-white mb-0">
                                <i class="material-icons me-2" style="vertical-align: middle;">assessment</i>
                                {% if session.get('lang', 'en') == 'ar' %}
                                    إضافة بيانات المنتج
                                {% else %}
                                    Add Product Data
                                {% endif %}
                            </h6>
                            <p class="text-white text-xs mb-0 opacity-8">
                                {% if session.get('lang', 'en') == 'ar' %}
                                    أكمل جميع الحقول لإضافة منتج جديد إلى توقعاتك
                                {% else %}
                                    Complete all fields to add a new product to your projections
                                {% endif %}
                            </p>
                        </div>
                        <div class="text-end">
                            <span class="badge badge-sm bg-white text-dark">
                                {% if session.get('lang', 'en') == 'ar' %}
                                    الخطوة 1 من 3
                                {% else %}
                                    Step 1 of 3
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="px-4 py-4">
                    <!-- Section 1: Basic Product Information -->
                    <div class="product-section mb-4">
                        <div class="section-header mb-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-sm bg-gradient-primary shadow text-center rounded-circle me-3">
                                    <i class="material-icons opacity-10" style="font-size: 18px; line-height: 32px;">inventory_2</i>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-dark">
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            معلومات المنتج الأساسية
                                        {% else %}
                                            Basic Product Information
                                        {% endif %}
                                    </h6>
                                    <p class="text-xs text-muted mb-0">
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            حدد المنتج وأدخل التفاصيل المالية
                                        {% else %}
                                            Select product and enter financial details
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">label</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            اسم المنتج
                                        {% else %}
                                            Product Name
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-control-modern" name="product_service_id" id="product_service_id" required>
                                        <option value="" disabled selected>
                                            {% if session.get('lang', 'en') == 'ar' %}
                                                اختر منتجاً...
                                            {% else %}
                                                Select a product...
                                            {% endif %}
                                        </option>
                                        {% for product in data_bp %}
                                            <option value="{{ product.product_service_id }}">{{ product.product_service_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">production_quantity_limits</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            الكمية (الوحدات)
                                        {% else %}
                                            Quantity (Units)
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control-modern" name="unit"
                                           placeholder="{% if session.get('lang', 'en') == 'ar' %}مثال: 1000{% else %}e.g., 1000{% endif %}"
                                           min="0" required>
                                </div>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">attach_money</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            السعر لكل وحدة
                                        {% else %}
                                            Price Per Unit
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control-modern" name="price"
                                           placeholder="{% if session.get('lang', 'en') == 'ar' %}مثال: 50.00{% else %}e.g., 50.00{% endif %}"
                                           step="0.01" min="0" required>
                                </div>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">money_off</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            التكلفة لكل وحدة
                                        {% else %}
                                            Cost Per Unit
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control-modern" name="cost"
                                           placeholder="{% if session.get('lang', 'en') == 'ar' %}مثال: 30.00{% else %}e.g., 30.00{% endif %}"
                                           step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="horizontal dark my-4">

                    <!-- Section 2: Growth Projections -->
                    <div class="product-section mb-4">
                        <div class="section-header mb-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                    <div class="icon-shape icon-sm bg-gradient-success shadow text-center rounded-circle me-3">
                                        <i class="material-icons opacity-10" style="font-size: 18px; line-height: 32px;">trending_up</i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0 text-dark">
                                            {% if session.get('lang', 'en') == 'ar' %}
                                                توقعات النمو السنوي
                                            {% else %}
                                                Annual Growth Projections
                                            {% endif %}
                                        </h6>
                                        <p class="text-xs text-muted mb-0">
                                            {% if session.get('lang', 'en') == 'ar' %}
                                                حدد نسبة النمو المتوقعة لكل سنة
                                            {% else %}
                                                Define expected growth percentage for each year
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="quickFillGrowth()">
                                    <i class="material-icons me-1" style="font-size: 14px;">flash_on</i>
                                    {% if session.get('lang', 'en') == 'ar' %}
                                        تعبئة سريعة
                                    {% else %}
                                        Quick Fill
                                    {% endif %}
                                </button>
                            </div>
                        </div>

                        <div class="growth-cards-container">
                            {% for year in range(1, 6) %}
                            <div class="growth-year-card">
                                <div class="year-badge">
                                    {% if session.get('lang', 'en') == 'ar' %}
                                        السنة {{ year }}
                                    {% else %}
                                        Year {{ year }}
                                    {% endif %}
                                </div>

                                <div class="form-group-modern mb-2">
                                    <label class="form-label-modern-sm">
                                        <i class="material-icons me-1" style="font-size: 14px;">percent</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            نسبة النمو
                                        {% else %}
                                            Growth %
                                        {% endif %}
                                    </label>
                                    <input type="number" class="form-control-modern-sm"
                                           name="growth_prct_year{{ year }}"
                                           id="growth_prct_year{{ year }}"
                                           placeholder="0.00"
                                           min="0"
                                           max="99.99"
                                           step="0.01">
                                </div>

                                <div class="form-group-modern mb-0">
    <label class="form-label-modern-sm">
        <i class="material-icons me-1" style="font-size: 14px;">lightbulb</i>
        {% if session.get('lang', 'en') == 'ar' %}
            أسباب النمو
        {% else %}
            Growth Drivers
        {% endif %}
    </label>

    <div class="vertical-chip-list" id="vertical_year{{ year }}">
        {% set items = [
            ('Marketing Efforts', 'جهود التسويق', 'Marketing Efforts'),
            ('Unfulfilled customer requests', 'طلبات العملاء غير الملباة', 'Unfulfilled Requests'),
            ('New market entry', 'دخول سوق جديد', 'New Market Entry'),
            ('Recruiting sales team', 'توظيف فريق المبيعات', 'Sales Team Expansion'),
            ('Increased market need', 'زيادة الطلب في السوق', 'Market Demand'),
            ('Improved product quality', 'تحسين جودة المنتج', 'Product Quality'),
            ('Enhanced distribution channels', 'تعزيز قنوات التوزيع', 'Distribution Channels'),
            ('Launching a new product', 'إطلاق منتج جديد', 'New Product Launch')
        ] %}

        {% for value, ar, en in items %}
            <div class="v-chip" data-value="{{ value }}">
                <span class="checkmark"></span>
                <span class="text">
                    {% if session.get('lang', 'en') == 'ar' %}
                        {{ ar }}
                    {% else %}
                        {{ en }}
                    {% endif %}
                </span>
            </div>
        {% endfor %}
    </div>

    <input type="hidden" id="vertical_hidden_{{ year }}" name="growth_reason_year{{ year }}">
</div>







                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                        <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                            <i class="material-icons me-1">refresh</i>
                            {% if session.get('lang', 'en') == 'ar' %}
                                إعادة تعيين
                            {% else %}
                                Reset Form
                            {% endif %}
                        </button>

                        <button type="button" class="btn btn-lg bg-gradient-info" id="product_add_btn" value="{{ bplan_id }}">
                            <i class="material-icons me-2">add_circle</i>
                            {% if session.get('lang', 'en') == 'ar' %}
                                إضافة المنتج إلى التوقعات
                            {% else %}
                                Add Product to Projections
                            {% endif %}
                        </button>
                    </div>
                </div>
            </div>
        </div>

</form>

<style>
/* Modern Form Styling */
.form-group-modern {
    position: relative;
}

.form-label-modern {
    display: flex;
    align-items: center;
    font-size: 0.875rem;
    font-weight: 600;
    color: #344767;
    margin-bottom: 0.5rem;
}

.form-label-modern i {
    font-size: 16px;
    color: #5e72e4;
}

.form-label-modern-sm {
    display: flex;
    align-items: center;
    font-size: 0.75rem;
    font-weight: 600;
    color: #344767;
    margin-bottom: 0.375rem;
}

.form-control-modern,
.form-control-modern-sm {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 0.625rem 0.875rem;
    font-size: 0.875rem;
    transition: all 0.3s ease;
    background-color: #f8f9fa;
}

.form-control-modern-sm {
    padding: 0.5rem 0.75rem;
    font-size: 0.8125rem;
}

.form-control-modern:focus,
.form-control-modern-sm:focus {
    border-color: #5e72e4;
    background-color: #fff;
    box-shadow: 0 0 0 0.2rem rgba(94, 114, 228, 0.1);
    outline: none;
}

.form-control-modern::placeholder,
.form-control-modern-sm::placeholder {
    color: #adb5bd;
    font-style: italic;
}

/* Section Headers */
.section-header {
    position: relative;
}

.icon-shape {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Growth Cards Grid */
.growth-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

@media (min-width: 1400px) {
    .growth-cards-container {
        grid-template-columns: repeat(5, 1fr);
    }
}

@media (min-width: 1200px) and (max-width: 1399px) {
    .growth-cards-container {
        grid-template-columns: repeat(4, 1fr);
    }
}

@media (min-width: 768px) and (max-width: 1199px) {
    .growth-cards-container {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 767px) {
    .growth-cards-container {
        grid-template-columns: repeat(2, 1fr);
    }
}

.growth-year-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px solid #dee2e6;
    border-radius: 12px;
    padding: 1rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.growth-year-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #5e72e4 0%, #825ee4 100%);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.growth-year-card:hover {
    border-color: #5e72e4;
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(94, 114, 228, 0.15);
}

.growth-year-card:hover::before {
    transform: scaleX(1);
}

.year-badge {
    display: inline-block;
    background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    letter-spacing: 0.5px;
}

/* Multi-select Styling */
.choices__inner {
    background-color: #f8f9fa !important;
    border: 2px solid #e9ecef !important;
    border-radius: 10px !important;
    min-height: 40px !important;
    padding: 0.375rem 0.5rem !important;
    transition: all 0.3s ease !important;
}

.choices__inner:focus,
.choices.is-focused .choices__inner {
    border-color: #5e72e4 !important;
    background-color: #fff !important;
    box-shadow: 0 0 0 0.2rem rgba(94, 114, 228, 0.1) !important;
}

.choices__list--multiple .choices__item {
    background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
    border: none;
    color: white;
    border-radius: 8px;
    padding: 0.25rem 0.5rem;
    margin: 0.125rem;
    font-size: 0.7rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    transition: all 0.2s ease;
}

.choices__list--multiple .choices__item:hover {
    transform: scale(1.05);
}

.choices__button {
    border-left: 1px solid rgba(255,255,255,0.3) !important;
    padding-left: 0.375rem !important;
    margin-left: 0.375rem !important;
    opacity: 0.8;
}

.choices__button:hover {
    opacity: 1;
}

.choices__list--dropdown .choices__item--selectable {
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
}

.choices__list--dropdown .choices__item--selectable:hover {
    background-color: #f0f2ff;
}

.choices__list--dropdown .choices__item--selectable.is-highlighted {
    background-color: #5e72e4;
    color: white;
}
/* Make dropdown wider than parent */
.growth-year-card .choices__list--dropdown {
    min-width: 300px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
}

/* Horizontal Rule */
.horizontal.dark {
    background-image: linear-gradient(90deg, transparent, rgba(0,0,0,0.1), transparent);
    height: 1px;
    border: none;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .icon-shape {
        width: 40px;
        height: 40px;
    }

    .section-header h6 {
        font-size: 0.9rem;
    }

    .growth-year-card {
        padding: 0.75rem;
    }
}

/* Animation for form load */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.product-section {
    animation: slideInUp 0.5s ease;
}

.product-section:nth-child(2) {
    animation-delay: 0.1s;
}

/* Button Hover Effects */
.btn {
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
}

#product_add_btn {
    font-weight: 600;
    letter-spacing: 0.5px;
    padding: 0.75rem 2rem;
}

#product_add_btn:hover {
    box-shadow: 0 10px 25px rgba(94, 114, 228, 0.3);
}

/* Fix for Choices.js Dropdown Width and Text Wrapping */
.choices__list--dropdown {
    width: 100% !important;
    min-width: 250px !important;
    max-width: 100% !important;
    z-index: 1000 !important;
}

.choices__list--dropdown .choices__item {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
}

/* Alternative: Allow wrapping but with better spacing */
.choices__list--dropdown .choices__item--selectable {
    padding: 0.75rem 1rem !important;
    white-space: normal !important;
    line-height: 1.4 !important;
    min-height: auto !important;
}

/* Ensure dropdown appears above other elements */
.choices[data-type*="select-multiple"] {
    position: relative;
    z-index: 100;
}

.choices__list--dropdown.is-active {
    z-index: 1001 !important;
}


.growth-chip-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.growth-chip {
    padding: 5px 10px;
    background: #f1f1f1;
    border-radius: 12px;
    cursor: pointer;
    user-select: none;
    border: 1px solid #ddd;
}

.growth-chip.selected {
    background: #007bff;
    color: white;
    border-color: #007bff;
}







.vertical-chip-list {
    max-height: 120px; /* shows ~4 items */
    overflow-y: auto;
    padding-right: 4px;
    scroll-behavior: smooth;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #fafafa;
}

.vertical-chip-list::-webkit-scrollbar {
    width: 6px;
}
.vertical-chip-list::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 6px;
}

.v-chip {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    margin: 4px 0;
    background: #f1f1f1;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.2s ease;
    border: 1px solid #ddd;
}

.v-chip.selected {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

.v-chip .checkmark {
    width: 14px;
    height: 14px;
    border-radius: 4px;
    border: 1px solid #aaa;
    background: white;
    transition: background 0.2s, border 0.2s;
}

.v-chip.selected .checkmark {
    background: white;
    border-color: white;
}
.v-chip {
    padding: 6px 10px;
}

.v-chip .text {
    font-size: 12px;
}


</style>

<script>
document.querySelectorAll('.vertical-chip-list').forEach(list => {
    let year = list.id.replace("vertical_year", "");
    let hidden = document.getElementById("vertical_hidden_" + year);

    list.querySelectorAll('.v-chip').forEach(chip => {
        chip.addEventListener('click', () => {
            chip.classList.toggle('selected');
            updateHidden();
        });
    });

    function updateHidden() {
        const selectedValues = [...list.querySelectorAll('.v-chip.selected')]
            .map(c => c.dataset.value);
        hidden.value = JSON.stringify(selectedValues);
    }
});
</script>























<form method="POST">
    <div class="row">
        <div class="col-12">
            <!-- Modern Card with Tabs -->
            <div class="card card-body bg-white shadow-lg border-0 px-0 py-0">

                <!-- Step Indicator -->
                <div class="bg-gradient-info px-4 py-3 rounded-top">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="text-white mb-0">
                                <i class="material-icons me-2" style="vertical-align: middle;">assessment</i>
                                {% if session.get('lang', 'en') == 'ar' %}
                                    إضافة بيانات المنتج
                                {% else %}
                                    Add Product Data
                                {% endif %}
                            </h6>
                            <p class="text-white text-xs mb-0 opacity-8">
                                {% if session.get('lang', 'en') == 'ar' %}
                                    أكمل جميع الحقول لإضافة منتج جديد إلى توقعاتك
                                {% else %}
                                    Complete all fields to add a new product to your projections
                                {% endif %}
                            </p>
                        </div>
                        <div class="text-end">
                            <span class="badge badge-sm bg-white text-dark">
                                {% if session.get('lang', 'en') == 'ar' %}
                                    الخطوة 1 من 3
                                {% else %}
                                    Step 1 of 3
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="px-4 py-4">
                    <!-- Section 1: Basic Product Information -->
                    <div class="product-section mb-4">
                        <div class="section-header mb-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape icon-sm bg-gradient-primary shadow text-center rounded-circle me-3">
                                    <i class="material-icons opacity-10" style="font-size: 18px; line-height: 32px;">inventory_2</i>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-dark">
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            معلومات المنتج الأساسية
                                        {% else %}
                                            Basic Product Information
                                        {% endif %}
                                    </h6>
                                    <p class="text-xs text-muted mb-0">
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            حدد المنتج وأدخل التفاصيل المالية
                                        {% else %}
                                            Select product and enter financial details
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">label</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            اسم المنتج
                                        {% else %}
                                            Product Name
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-control-modern" name="product_service_id" id="product_service_id" required>
                                        <option value="" disabled selected>
                                            {% if session.get('lang', 'en') == 'ar' %}
                                                اختر منتجاً...
                                            {% else %}
                                                Select a product...
                                            {% endif %}
                                        </option>
                                        {% for product in data_bp %}
                                            <option value="{{ product.product_service_id }}">{{ product.product_service_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">production_quantity_limits</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            الكمية (الوحدات)
                                        {% else %}
                                            Quantity (Units)
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control-modern" name="unit"
                                           placeholder="{% if session.get('lang', 'en') == 'ar' %}مثال: 1000{% else %}e.g., 1000{% endif %}"
                                           min="0" required>
                                </div>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">attach_money</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            السعر لكل وحدة
                                        {% else %}
                                            Price Per Unit
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control-modern" name="price"
                                           placeholder="{% if session.get('lang', 'en') == 'ar' %}مثال: 50.00{% else %}e.g., 50.00{% endif %}"
                                           step="0.01" min="0" required>
                                </div>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <div class="form-group-modern">
                                    <label class="form-label-modern">
                                        <i class="material-icons me-1">money_off</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            التكلفة لكل وحدة
                                        {% else %}
                                            Cost Per Unit
                                        {% endif %}
                                        <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control-modern" name="cost"
                                           placeholder="{% if session.get('lang', 'en') == 'ar' %}مثال: 30.00{% else %}e.g., 30.00{% endif %}"
                                           step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="horizontal dark my-4">

                    <!-- Section 2: Growth Projections -->
                    <div class="product-section mb-4">
                        <div class="section-header mb-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                    <div class="icon-shape icon-sm bg-gradient-success shadow text-center rounded-circle me-3">
                                        <i class="material-icons opacity-10" style="font-size: 18px; line-height: 32px;">trending_up</i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0 text-dark">
                                            {% if session.get('lang', 'en') == 'ar' %}
                                                توقعات النمو السنوي
                                            {% else %}
                                                Annual Growth Projections
                                            {% endif %}
                                        </h6>
                                        <p class="text-xs text-muted mb-0">
                                            {% if session.get('lang', 'en') == 'ar' %}
                                                حدد نسبة النمو المتوقعة لكل سنة
                                            {% else %}
                                                Define expected growth percentage for each year
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="quickFillGrowth()">
                                    <i class="material-icons me-1" style="font-size: 14px;">flash_on</i>
                                    {% if session.get('lang', 'en') == 'ar' %}
                                        تعبئة سريعة
                                    {% else %}
                                        Quick Fill
                                    {% endif %}
                                </button>
                            </div>
                        </div>

                        <div class="growth-cards-container">
                            {% for year in range(1, 6) %}
                            <div class="growth-year-card">
                                <div class="year-badge">
                                    {% if session.get('lang', 'en') == 'ar' %}
                                        السنة {{ year }}
                                    {% else %}
                                        Year {{ year }}
                                    {% endif %}
                                </div>

                                <div class="form-group-modern mb-2">
                                    <label class="form-label-modern-sm">
                                        <i class="material-icons me-1" style="font-size: 14px;">percent</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            نسبة النمو
                                        {% else %}
                                            Growth %
                                        {% endif %}
                                    </label>
                                    <input type="number" class="form-control-modern-sm"
                                           name="growth_prct_year{{ year }}"
                                           id="growth_prct_year{{ year }}"
                                           placeholder="0.00"
                                           min="0"
                                           max="99.99"
                                           step="0.01">
                                </div>

                                <div class="form-group-modern mb-0">
                                    <label class="form-label-modern-sm">
                                        <i class="material-icons me-1" style="font-size: 14px;">lightbulb</i>
                                        {% if session.get('lang', 'en') == 'ar' %}
                                            أسباب النمو
                                        {% else %}
                                            Growth Drivers
                                        {% endif %}
                                    </label>
                                    <select class="form-control-modern-sm growth-reason-multiselect"
                                            name="growth_reason_year{{ year }}"
                                            id="growth_reason_year{{ year }}"
                                            multiple>
                                        <option value="Marketing Efforts">
                                            {% if session.get('lang', 'en') == 'ar' %}جهود التسويق{% else %}Marketing Efforts{% endif %}
                                        </option>
                                        <option value="Unfulfilled customer requests">
                                            {% if session.get('lang', 'en') == 'ar' %}طلبات العملاء غير الملباة{% else %}Unfulfilled Requests{% endif %}
                                        </option>
                                        <option value="New market entry">
                                            {% if session.get('lang', 'en') == 'ar' %}دخول سوق جديد{% else %}New Market Entry{% endif %}
                                        </option>
                                        <option value="Recruiting sales team">
                                            {% if session.get('lang', 'en') == 'ar' %}توظيف فريق المبيعات{% else %}Sales Team Expansion{% endif %}
                                        </option>
                                        <option value="Increased market need">
                                            {% if session.get('lang', 'en') == 'ar' %}زيادة الطلب في السوق{% else %}Market Demand{% endif %}
                                        </option>
                                        <option value="Improved product quality">
                                            {% if session.get('lang', 'en') == 'ar' %}تحسين جودة المنتج{% else %}Product Quality{% endif %}
                                        </option>
                                        <option value="Enhanced distribution channels">
                                            {% if session.get('lang', 'en') == 'ar' %}تعزيز قنوات التوزيع{% else %}Distribution Channels{% endif %}
                                        </option>
                                        <option value="Launching a new product">
                                            {% if session.get('lang', 'en') == 'ar' %}إطلاق منتج جديد{% else %}New Product Launch{% endif %}
                                        </option>
                                    </select>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                        <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                            <i class="material-icons me-1">refresh</i>
                            {% if session.get('lang', 'en') == 'ar' %}
                                إعادة تعيين
                            {% else %}
                                Reset Form
                            {% endif %}
                        </button>

                        <button type="button" class="btn btn-lg bg-gradient-info" id="product_add_btn" value="{{ bplan_id }}">
                            <i class="material-icons me-2">add_circle</i>
                            {% if session.get('lang', 'en') == 'ar' %}
                                إضافة المنتج إلى التوقعات
                            {% else %}
                                Add Product to Projections
                            {% endif %}
                        </button>
                    </div>
                </div>
            </div>
        </div>

</form>

<style>
/* Modern Form Styling */
.form-group-modern {
    position: relative;
}

.form-label-modern {
    display: flex;
    align-items: center;
    font-size: 0.875rem;
    font-weight: 600;
    color: #344767;
    margin-bottom: 0.5rem;
}

.form-label-modern i {
    font-size: 16px;
    color: #5e72e4;
}

.form-label-modern-sm {
    display: flex;
    align-items: center;
    font-size: 0.75rem;
    font-weight: 600;
    color: #344767;
    margin-bottom: 0.375rem;
}

.form-control-modern,
.form-control-modern-sm {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 0.625rem 0.875rem;
    font-size: 0.875rem;
    transition: all 0.3s ease;
    background-color: #f8f9fa;
}

.form-control-modern-sm {
    padding: 0.5rem 0.75rem;
    font-size: 0.8125rem;
}

.form-control-modern:focus,
.form-control-modern-sm:focus {
    border-color: #5e72e4;
    background-color: #fff;
    box-shadow: 0 0 0 0.2rem rgba(94, 114, 228, 0.1);
    outline: none;
}

.form-control-modern::placeholder,
.form-control-modern-sm::placeholder {
    color: #adb5bd;
    font-style: italic;
}

/* Section Headers */
.section-header {
    position: relative;
}

.icon-shape {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Growth Cards Grid */
.growth-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

@media (min-width: 1400px) {
    .growth-cards-container {
        grid-template-columns: repeat(5, 1fr);
    }
}

@media (min-width: 1200px) and (max-width: 1399px) {
    .growth-cards-container {
        grid-template-columns: repeat(4, 1fr);
    }
}

@media (min-width: 768px) and (max-width: 1199px) {
    .growth-cards-container {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 767px) {
    .growth-cards-container {
        grid-template-columns: repeat(2, 1fr);
    }
}

.growth-year-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px solid #dee2e6;
    border-radius: 12px;
    padding: 1rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.growth-year-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #5e72e4 0%, #825ee4 100%);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.growth-year-card:hover {
    border-color: #5e72e4;
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(94, 114, 228, 0.15);
}

.growth-year-card:hover::before {
    transform: scaleX(1);
}

.year-badge {
    display: inline-block;
    background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    letter-spacing: 0.5px;
}

/* Multi-select Styling */
.choices__inner {
    background-color: #f8f9fa !important;
    border: 2px solid #e9ecef !important;
    border-radius: 10px !important;
    min-height: 40px !important;
    padding: 0.375rem 0.5rem !important;
    transition: all 0.3s ease !important;
}

.choices__inner:focus,
.choices.is-focused .choices__inner {
    border-color: #5e72e4 !important;
    background-color: #fff !important;
    box-shadow: 0 0 0 0.2rem rgba(94, 114, 228, 0.1) !important;
}

.choices__list--multiple .choices__item {
    background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
    border: none;
    color: white;
    border-radius: 8px;
    padding: 0.25rem 0.5rem;
    margin: 0.125rem;
    font-size: 0.7rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    transition: all 0.2s ease;
}

.choices__list--multiple .choices__item:hover {
    transform: scale(1.05);
}

.choices__button {
    border-left: 1px solid rgba(255,255,255,0.3) !important;
    padding-left: 0.375rem !important;
    margin-left: 0.375rem !important;
    opacity: 0.8;
}

.choices__button:hover {
    opacity: 1;
}

.choices__list--dropdown .choices__item--selectable {
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
}

.choices__list--dropdown .choices__item--selectable:hover {
    background-color: #f0f2ff;
}

.choices__list--dropdown .choices__item--selectable.is-highlighted {
    background-color: #5e72e4;
    color: white;
}
/* Make dropdown wider than parent */
.growth-year-card .choices__list--dropdown {
    min-width: 300px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
}

/* Horizontal Rule */
.horizontal.dark {
    background-image: linear-gradient(90deg, transparent, rgba(0,0,0,0.1), transparent);
    height: 1px;
    border: none;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .icon-shape {
        width: 40px;
        height: 40px;
    }

    .section-header h6 {
        font-size: 0.9rem;
    }

    .growth-year-card {
        padding: 0.75rem;
    }
}

/* Animation for form load */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.product-section {
    animation: slideInUp 0.5s ease;
}

.product-section:nth-child(2) {
    animation-delay: 0.1s;
}

/* Button Hover Effects */
.btn {
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
}

#product_add_btn {
    font-weight: 600;
    letter-spacing: 0.5px;
    padding: 0.75rem 2rem;
}

#product_add_btn:hover {
    box-shadow: 0 10px 25px rgba(94, 114, 228, 0.3);
}

/* Fix for Choices.js Dropdown Width and Text Wrapping */
.choices__list--dropdown {
    width: 100% !important;
    min-width: 250px !important;
    max-width: 100% !important;
    z-index: 1000 !important;
}

.choices__list--dropdown .choices__item {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
}

/* Alternative: Allow wrapping but with better spacing */
.choices__list--dropdown .choices__item--selectable {
    padding: 0.75rem 1rem !important;
    white-space: normal !important;
    line-height: 1.4 !important;
    min-height: auto !important;
}

/* Ensure dropdown appears above other elements */
.choices[data-type*="select-multiple"] {
    position: relative;
    z-index: 100;
}

.choices__list--dropdown.is-active {
    z-index: 1001 !important;
}
</style>

<script>
// Quick Fill Growth Function
function quickFillGrowth() {
    const value = prompt(
        document.documentElement.lang === 'ar'
            ? 'أدخل نسبة النمو لجميع السنوات:'
            : 'Enter growth percentage for all years:'
    );

    if (value !== null && value !== '') {
        for (let year = 1; year <= 5; year++) {
            const input = document.getElementById(`growth_prct_year${year}`);
            if (input) input.value = value;
        }
    }
}

// Reset Form Function
function resetForm() {
    if (confirm(
        document.documentElement.lang === 'ar'
            ? 'هل أنت متأكد من إعادة تعيين النموذج؟'
            : 'Are you sure you want to reset the form?'
    )) {
        document.querySelector('[name="unit"]').value = '';
        document.querySelector('[name="price"]').value = '';
        document.querySelector('[name="cost"]').value = '';

        for (let year = 1; year <= 5; year++) {
            const growthInput = document.getElementById(`growth_prct_year${year}`);
            if (growthInput) growthInput.value = '';

            const reasonSelect = document.getElementById(`growth_reason_year${year}`);
            if (reasonSelect && reasonSelect.choices) {
                reasonSelect.choices.removeActiveItems();
            }
        }
    }
}
</script>
